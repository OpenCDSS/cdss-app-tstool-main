
<project name="TSTool" default="compile-java" basedir="../">
    <import file="../../rtibuild/common-build.xml"/>
    <import file="../../rtibuild/common-installer.xml"/>
    
    <target name="local-install-CDSS" description="CDSS local install" depends="-init-CDSS,local-install"/>
    
    <target name="local-install-rivertrack" description="rivertrack local install" depends="-init-rivertrack,local-install"/>
    
    <target name="nsis-CDSS" depends="-init,-clean-logs"  description="CDSS nsis installer">
        <nsisinstaller dir="installer/CDSS" nsi="TSTool.nsi"/>
    </target>
    
    <target name="installer-CDSS" description="CDSS nsis installer" depends="local-install-CDSS,nsis-CDSS"/>
    
    <target name="nsis-rivertrack" depends="-init,-clean-logs" description="rivertrack nsis installer">
        <nsisinstaller nsi="rivertrack/TSTool.nsi"/>
    </target>
    
    <target name="installer-rivertrack" description="rivertrack nsis installer" depends="local-install-rivertrack,nsis-rivertrack"/>
    
    <target name="-clean-logs" description="clean log directories before installer">
        <delete dir="${install.dir}/logs" includes="*"/>
    </target>
    
    <!-- this is called after standard-local-install and allows common resources to be copied in -->
    <target name="-install-local" depends="-install-local-cdss,-install-local-rti">
        <copy todir="${install.dir}/bin" file="externals/shellcon/shellcon.exe"/>
        <copy todir="${install.dir}/bin" file="scripts/TSTool.bat"/>
        <copy todir="${install.dir}/bin" file="installer/common/TSTool.ini"/>
    	<mkdir dir="${install.dir}/logs"/>
    </target>
    
    <!-- the following two targets perform initialization of properties -->
    <target name="-init-CDSS" depends="-init">
        <!-- set the installer.cdss property to allow the appropriate post-installer-xxx to run-->
        <property name="installer.cdss" value="true"/>
        <!-- alternatively, properties could be loaded from a file ...
        <property file="installer/CDSS/install.properties"/>
        -->
        <property name="install.dir" value="${dist.dir}/install-CDSS"/>
        <property name="license.file" value="externals/CDSS/system/TSTool.cfg"/>
    </target>
    
    <target name="-init-rivertrack" depends="-init">
        <property name="install.dir" value="${dist.dir}/install-rivertrack"/>
        <property name="license.file" value="test/operational/RTi/system/TSTool.cfg"/>
    </target>
    
    <!-- the following two targets copy additional resources to local install dirs -->
    <target name="-install-local-cdss" if="installer.cdss">
        <copy todir="${install.dir}/bin" file="externals/CDSS/installer/TSTool.exe"/>
        <copy todir="${install.dir}/system">
            <fileset dir="externals/CDSS/system" includes="*"/>
        </copy>
    </target>
    
    <target name="-install-local-rti" if="installer.rti">
        <copy todir="${install.dir}/bin" file="installer/common/TSTool.exe"/>
        <copy todir="${install.dir}/system">
            <fileset dir="externals/Rivertrak/system" includes="*"/>
        </copy>
    </target>
    
</project>
